pipeline {
    agent any
    
    // Production-grade options
    options {
        timeout(time: 15, unit: 'MINUTES')
        timestamps()
        buildDiscarder(logRotator(numToKeepStr: '10'))
        skipDefaultCheckout()
    }
    
    // Environment variables
    environment {
        APP_NAME = 'parameterized-microservice'
        BUILD_TIMESTAMP = "${new Date().format('yyyyMMdd-HHmmss')}"
    }
    
    // Parameterized build parameters
    parameters {
        choice(
            name: 'ENVIRONMENT',
            choices: ['Development', 'Staging', 'Production'],
            description: 'Select the deployment environment'
        )
        string(
            name: 'VERSION',
            defaultValue: '1.0.0',
            description: 'Specify the application version'
        )
        booleanParam(
            name: 'RUN_TESTS',
            defaultValue: true,
            description: 'Run automated tests before deployment?'
        )
        choice(
            name: 'FEATURES',
            choices: ['Basic', 'Advanced', 'Enterprise'],
            description: 'Select feature set to deploy'
        )
        string(
            name: 'DEPLOYMENT_NOTES',
            defaultValue: 'Standard deployment',
            description: 'Add deployment notes (optional)'
        )
    }
    
    stages {
        stage('ğŸ“‹ Parameter Validation') {
            steps {
                sh '''
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ“‹ PARAMETER VALIDATION                                  â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ User Input Parameters:"
                    echo "â•‘     â€¢ Environment: ${ENVIRONMENT}"
                    echo "â•‘     â€¢ Version: ${VERSION}"
                    echo "â•‘     â€¢ Run Tests: ${RUN_TESTS}"
                    echo "â•‘     â€¢ Features: ${FEATURES}"
                    echo "â•‘     â€¢ Deployment Notes: ${DEPLOYMENT_NOTES}"
                    
                    # System information
                    HOSTNAME=$(hostname)
                    IP_ADDRESS=$(hostname -I | awk '{print $1}')
                    CURRENT_TIME=$(date)
                    
                    echo "â•‘"
                    echo "â•‘  ğŸ–¥ï¸  System Information:"
                    echo "â•‘     â€¢ Build host: $HOSTNAME"
                    echo "â•‘     â€¢ IP address: $IP_ADDRESS"
                    echo "â•‘     â€¢ Build time: $CURRENT_TIME"
                    echo "â•‘     â€¢ Build number: ${BUILD_NUMBER}"
                    
                    # Parameter validation
                    echo "â•‘"
                    echo "â•‘  âœ… Parameter Validation:"
                    if [ "${ENVIRONMENT}" = "Production" ]; then
                        echo "â•‘     â€¢ âš ï¸  PRODUCTION DEPLOYMENT DETECTED"
                        echo "â•‘     â€¢ Extra validation steps will be performed"
                    else
                        echo "â•‘     â€¢ Environment: ${ENVIRONMENT} (Safe for testing)"
                    fi
                    
                    if [ "${RUN_TESTS}" = "true" ]; then
                        echo "â•‘     â€¢ Tests will be executed before deployment"
                    else
                        echo "â•‘     â€¢ Tests will be skipped (user choice)"
                    fi
                    
                    echo "â•‘     â€¢ Feature set: ${FEATURES}"
                    echo "â•‘     â€¢ Version: ${VERSION}"
                    
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                '''
            }
        }
        
        stage('ğŸ” Environment Analysis') {
            steps {
                sh '''
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ” ENVIRONMENT ANALYSIS                                   â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    
                    # Environment-specific configuration
                    case "${ENVIRONMENT}" in
                        "Development")
                            echo "â•‘  ğŸ› ï¸  Development Environment:"
                            echo "â•‘     â€¢ Purpose: Development and testing"
                            echo "â•‘     â€¢ Database: Local SQLite"
                            echo "â•‘     â€¢ Logging: Debug level"
                            echo "â•‘     â€¢ Monitoring: Basic"
                            echo "â•‘     â€¢ Security: Relaxed"
                            ;;
                        "Staging")
                            echo "â•‘  ğŸ§ª Staging Environment:"
                            echo "â•‘     â€¢ Purpose: Pre-production testing"
                            echo "â•‘     â€¢ Database: Production-like"
                            echo "â•‘     â€¢ Logging: Info level"
                            echo "â•‘     â€¢ Monitoring: Full"
                            echo "â•‘     â€¢ Security: Production-like"
                            ;;
                        "Production")
                            echo "â•‘  ğŸš€ Production Environment:"
                            echo "â•‘     â€¢ Purpose: Live user traffic"
                            echo "â•‘     â€¢ Database: Production cluster"
                            echo "â•‘     â€¢ Logging: Warning level"
                            echo "â•‘     â€¢ Monitoring: Full + Alerts"
                            echo "â•‘     â€¢ Security: Maximum"
                            ;;
                    esac
                    
                    # Feature-specific configuration
                    echo "â•‘"
                    echo "â•‘  ğŸ›ï¸  Feature Configuration:"
                    case "${FEATURES}" in
                        "Basic")
                            echo "â•‘     â€¢ Features: Core functionality only"
                            echo "â•‘     â€¢ Resources: 1 CPU, 512MB RAM"
                            echo "â•‘     â€¢ Scaling: Manual"
                            echo "â•‘     â€¢ Support: Community"
                            ;;
                        "Advanced")
                            echo "â•‘     â€¢ Features: Core + Advanced features"
                            echo "â•‘     â€¢ Resources: 2 CPU, 1GB RAM"
                            echo "â•‘     â€¢ Scaling: Auto-scaling"
                            echo "â•‘     â€¢ Support: Business hours"
                            ;;
                        "Enterprise")
                            echo "â•‘     â€¢ Features: All features + Premium"
                            echo "â•‘     â€¢ Resources: 4 CPU, 4GB RAM"
                            echo "â•‘     â€¢ Scaling: Multi-region"
                            echo "â•‘     â€¢ Support: 24/7"
                            ;;
                    esac
                    
                    # System resources
                    echo "â•‘"
                    echo "â•‘  ğŸ’» Available Resources:"
                    CPU_CORES=$(nproc)
                    TOTAL_MEM=$(free -h | grep Mem | awk '{print $2}')
                    USED_MEM=$(free -h | grep Mem | awk '{print $3}')
                    AVAIL_MEM=$(free -h | grep Mem | awk '{print $7}')
                    DISK_AVAIL=$(df -h . | tail -1 | awk '{print $4}')
                    
                    echo "â•‘     â€¢ CPU cores: $CPU_CORES"
                    echo "â•‘     â€¢ Total memory: $TOTAL_MEM"
                    echo "â•‘     â€¢ Used memory: $USED_MEM"
                    echo "â•‘     â€¢ Available memory: $AVAIL_MEM"
                    echo "â•‘     â€¢ Available disk: $DISK_AVAIL"
                    
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                '''
            }
        }
        
        stage('ğŸ§ª Conditional Testing') {
            when {
                expression { params.RUN_TESTS == true }
            }
            steps {
                sh '''
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ§ª CONDITIONAL TESTING                                   â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸš€ Running tests (user requested)..."
                    
                    # Test execution based on environment
                    case "${ENVIRONMENT}" in
                        "Development")
                            echo "â•‘     â€¢ Running: Unit tests only"
                            echo "â•‘     â€¢ Test scope: Basic functionality"
                            echo "â•‘     â€¢ Coverage: 80% minimum"
                            ;;
                        "Staging")
                            echo "â•‘     â€¢ Running: Unit + Integration tests"
                            echo "â•‘     â€¢ Test scope: Full functionality"
                            echo "â•‘     â€¢ Coverage: 90% minimum"
                            ;;
                        "Production")
                            echo "â•‘     â€¢ Running: Full test suite"
                            echo "â•‘     â€¢ Test scope: All features + Performance"
                            echo "â•‘     â€¢ Coverage: 95% minimum"
                            ;;
                    esac
                    
                    # Simulate test execution
                    echo "â•‘"
                    echo "â•‘  ğŸ“Š Test Results:"
                    echo "â•‘     â€¢ Unit tests: âœ… PASSED (45/45)"
                    echo "â•‘     â€¢ Integration tests: âœ… PASSED (12/12)"
                    echo "â•‘     â€¢ Code coverage: 92.3%"
                    echo "â•‘     â€¢ Performance tests: âœ… PASSED"
                    echo "â•‘     â€¢ Security tests: âœ… PASSED"
                    
                    echo "â•‘"
                    echo "â•‘  âœ… All tests passed successfully!"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                '''
            }
        }
        
        stage('ğŸ³ Dynamic Container Build') {
            steps {
                sh '''
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                  ğŸ³ DYNAMIC CONTAINER BUILD                                 â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ—ï¸  Building container with parameters..."
                    
                    # Dynamic image tagging
                    IMAGE_TAG="${VERSION}-${ENVIRONMENT,,}-${FEATURES,,}-${BUILD_NUMBER}"
                    echo "â•‘     â€¢ Image: ${APP_NAME}:${IMAGE_TAG}"
                    echo "â•‘     â€¢ Version: ${VERSION}"
                    echo "â•‘     â€¢ Environment: ${ENVIRONMENT}"
                    echo "â•‘     â€¢ Features: ${FEATURES}"
                    
                    # Build environment info
                    BUILD_TIME=$(date)
                    BUILD_HOST=$(hostname)
                    DOCKER_VER=$(docker --version 2>/dev/null || echo 'Docker not available')
                    
                    echo "â•‘"
                    echo "â•‘  ğŸ“Š Build Environment:"
                    echo "â•‘     â€¢ Build time: $BUILD_TIME"
                    echo "â•‘     â€¢ Build host: $BUILD_HOST"
                    echo "â•‘     â€¢ Docker version: $DOCKER_VER"
                    
                    # Feature-specific build steps
                    echo "â•‘"
                    echo "â•‘  ğŸ”§ Build Configuration:"
                    case "${FEATURES}" in
                        "Basic")
                            echo "â•‘     â€¢ Base image: alpine:latest"
                            echo "â•‘     â€¢ Dependencies: Minimal"
                            echo "â•‘     â€¢ Size: ~50MB"
                            ;;
                        "Advanced")
                            echo "â•‘     â€¢ Base image: ubuntu:20.04"
                            echo "â•‘     â€¢ Dependencies: Standard"
                            echo "â•‘     â€¢ Size: ~200MB"
                            ;;
                        "Enterprise")
                            echo "â•‘     â€¢ Base image: ubuntu:20.04"
                            echo "â•‘     â€¢ Dependencies: Full stack"
                            echo "â•‘     â€¢ Size: ~500MB"
                            ;;
                    esac
                    
                    # Environment-specific configuration
                    echo "â•‘"
                    echo "â•‘  ğŸŒ Environment Configuration:"
                    case "${ENVIRONMENT}" in
                        "Development")
                            echo "â•‘     â€¢ Debug mode: Enabled"
                            echo "â•‘     â€¢ Logging: Verbose"
                            echo "â•‘     â€¢ Hot reload: Enabled"
                            ;;
                        "Staging")
                            echo "â•‘     â€¢ Debug mode: Disabled"
                            echo "â•‘     â€¢ Logging: Standard"
                            echo "â•‘     â€¢ Performance: Optimized"
                            ;;
                        "Production")
                            echo "â•‘     â€¢ Debug mode: Disabled"
                            echo "â•‘     â€¢ Logging: Minimal"
                            echo "â•‘     â€¢ Performance: Maximum"
                            echo "â•‘     â€¢ Security: Hardened"
                            ;;
                    esac
                    
                    echo "â•‘"
                    echo "â•‘  âœ… Container build completed successfully!"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                '''
            }
        }
        
        stage('ğŸš€ Smart Deployment') {
            steps {
                sh '''
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸš€ SMART DEPLOYMENT                                      â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Deploying to ${ENVIRONMENT} environment..."
                    
                    # Deployment details
                    DEPLOY_TIME=$(date)
                    DEPLOY_USER=$(whoami)
                    HOSTNAME=$(hostname)
                    IP_ADDRESS=$(hostname -I | awk '{print $1}')
                    
                    echo "â•‘     â€¢ Target: ${ENVIRONMENT}"
                    echo "â•‘     â€¢ Version: ${VERSION}"
                    echo "â•‘     â€¢ Features: ${FEATURES}"
                    echo "â•‘     â€¢ Deploy time: $DEPLOY_TIME"
                    echo "â•‘     â€¢ Deploy user: $DEPLOY_USER"
                    echo "â•‘     â€¢ Target host: $HOSTNAME"
                    echo "â•‘     â€¢ IP address: $IP_ADDRESS"
                    
                    # Environment-specific deployment steps
                    echo "â•‘"
                    echo "â•‘  ğŸ”„ Deployment Steps:"
                    case "${ENVIRONMENT}" in
                        "Development")
                            echo "â•‘     â€¢ Step 1: Quick deployment"
                            echo "â•‘     â€¢ Step 2: Basic health check"
                            echo "â•‘     â€¢ Step 3: Development tools setup"
                            ;;
                        "Staging")
                            echo "â•‘     â€¢ Step 1: Blue-green deployment"
                            echo "â•‘     â€¢ Step 2: Full health check"
                            echo "â•‘     â€¢ Step 3: Smoke tests"
                            echo "â•‘     â€¢ Step 4: Performance validation"
                            ;;
                        "Production")
                            echo "â•‘     â€¢ Step 1: Backup current version"
                            echo "â•‘     â€¢ Step 2: Blue-green deployment"
                            echo "â•‘     â€¢ Step 3: Comprehensive health check"
                            echo "â•‘     â€¢ Step 4: Load testing"
                            echo "â•‘     â€¢ Step 5: Monitoring setup"
                            echo "â•‘     â€¢ Step 6: Rollback preparation"
                            ;;
                    esac
                    
                    # Feature-specific deployment
                    echo "â•‘"
                    echo "â•‘  ğŸ›ï¸  Feature Deployment:"
                    case "${FEATURES}" in
                        "Basic")
                            echo "â•‘     â€¢ Deploying: Core features only"
                            echo "â•‘     â€¢ Resources: 1 CPU, 512MB RAM"
                            echo "â•‘     â€¢ Scaling: Manual"
                            ;;
                        "Advanced")
                            echo "â•‘     â€¢ Deploying: Core + Advanced features"
                            echo "â•‘     â€¢ Resources: 2 CPU, 1GB RAM"
                            echo "â•‘     â€¢ Scaling: Auto-scaling enabled"
                            ;;
                        "Enterprise")
                            echo "â•‘     â€¢ Deploying: All features + Premium"
                            echo "â•‘     â€¢ Resources: 4 CPU, 4GB RAM"
                            echo "â•‘     â€¢ Scaling: Multi-region enabled"
                            echo "â•‘     â€¢ High availability: Enabled"
                            ;;
                    esac
                    
                    # System state after deployment
                    echo "â•‘"
                    echo "â•‘  ğŸ“Š Post-Deployment State:"
                    RUNNING_PROCS=$(ps aux | wc -l)
                    echo "â•‘     â€¢ Running processes: $RUNNING_PROCS"
                    echo "â•‘     â€¢ Service status: Running"
                    echo "â•‘     â€¢ Health check: âœ… PASSED"
                    echo "â•‘     â€¢ Monitoring: Active"
                    
                    echo "â•‘"
                    echo "â•‘  âœ… Deployment to ${ENVIRONMENT} completed successfully!"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                '''
            }
        }
        
        stage('ğŸ“Š Parameterized Monitoring') {
            steps {
                sh '''
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                ğŸ“Š PARAMETERIZED MONITORING                                 â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ”§ Monitoring Configuration:"
                    echo "â•‘     â€¢ Environment: ${ENVIRONMENT}"
                    echo "â•‘     â€¢ Version: ${VERSION}"
                    echo "â•‘     â€¢ Features: ${FEATURES}"
                    echo "â•‘     â€¢ Health endpoints: /health, /ready"
                    
                    # Environment-specific monitoring
                    echo "â•‘"
                    echo "â•‘  ğŸ“ˆ Environment-Specific Monitoring:"
                    case "${ENVIRONMENT}" in
                        "Development")
                            echo "â•‘     â€¢ Logging: Debug level"
                            echo "â•‘     â€¢ Metrics: Basic"
                            echo "â•‘     â€¢ Alerts: None"
                            echo "â•‘     â€¢ Dashboard: Simple"
                            ;;
                        "Staging")
                            echo "â•‘     â€¢ Logging: Info level"
                            echo "â•‘     â€¢ Metrics: Full"
                            echo "â•‘     â€¢ Alerts: Email only"
                            echo "â•‘     â€¢ Dashboard: Standard"
                            ;;
                        "Production")
                            echo "â•‘     â€¢ Logging: Warning level"
                            echo "â•‘     â€¢ Metrics: Full + Custom"
                            echo "â•‘     â€¢ Alerts: Email + SMS + PagerDuty"
                            echo "â•‘     â€¢ Dashboard: Advanced + Real-time"
                            ;;
                    esac
                    
                    # Feature-specific monitoring
                    echo "â•‘"
                    echo "â•‘  ğŸ›ï¸  Feature-Specific Monitoring:"
                    case "${FEATURES}" in
                        "Basic")
                            echo "â•‘     â€¢ CPU monitoring: Basic"
                            echo "â•‘     â€¢ Memory monitoring: Basic"
                            echo "â•‘     â€¢ Custom metrics: None"
                            ;;
                        "Advanced")
                            echo "â•‘     â€¢ CPU monitoring: Advanced"
                            echo "â•‘     â€¢ Memory monitoring: Advanced"
                            echo "â•‘     â€¢ Custom metrics: Business metrics"
                            echo "â•‘     â€¢ Performance monitoring: Enabled"
                            ;;
                        "Enterprise")
                            echo "â•‘     â€¢ CPU monitoring: Enterprise"
                            echo "â•‘     â€¢ Memory monitoring: Enterprise"
                            echo "â•‘     â€¢ Custom metrics: Full suite"
                            echo "â•‘     â€¢ Performance monitoring: Advanced"
                            echo "â•‘     â€¢ Security monitoring: Enabled"
                            echo "â•‘     â€¢ Compliance monitoring: Enabled"
                            ;;
                    esac
                    
                    # System status
                    echo "â•‘"
                    echo "â•‘  ğŸ–¥ï¸  Current System Status:"
                    SYSTEM_UPTIME=$(uptime -p)
                    CURRENT_TIME=$(date)
                    HOSTNAME=$(hostname)
                    IP_ADDRESS=$(hostname -I | awk '{print $1}')
                    
                    echo "â•‘     â€¢ System uptime: $SYSTEM_UPTIME"
                    echo "â•‘     â€¢ Current time: $CURRENT_TIME"
                    echo "â•‘     â€¢ Hostname: $HOSTNAME"
                    echo "â•‘     â€¢ IP address: $IP_ADDRESS"
                    
                    # Resource usage
                    CPU_CORES=$(nproc)
                    TOTAL_MEM=$(free -h | grep Mem | awk '{print $2}')
                    USED_MEM=$(free -h | grep Mem | awk '{print $3}')
                    AVAIL_MEM=$(free -h | grep Mem | awk '{print $7}')
                    
                    echo "â•‘"
                    echo "â•‘  ğŸ’» Resource Usage:"
                    echo "â•‘     â€¢ CPU cores: $CPU_CORES"
                    echo "â•‘     â€¢ Total memory: $TOTAL_MEM"
                    echo "â•‘     â€¢ Used memory: $USED_MEM"
                    echo "â•‘     â€¢ Available memory: $AVAIL_MEM"
                    
                    echo "â•‘"
                    echo "â•‘  âœ… Monitoring configured for ${ENVIRONMENT} with ${FEATURES} features!"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                '''
            }
        }
    }
    
    post {
        always {
            script {
                def gitCommit = env.GIT_COMMIT ? env.GIT_COMMIT[0..7] : 'unknown'
                echo ""
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                    ğŸ“Š PARAMETERIZED BUILD SUMMARY                            â•‘"
                echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                echo "â•‘  ğŸ¯ Build Parameters:"
                echo "â•‘     â€¢ Environment: ${params.ENVIRONMENT}"
                echo "â•‘     â€¢ Version: ${params.VERSION}"
                echo "â•‘     â€¢ Features: ${params.FEATURES}"
                echo "â•‘     â€¢ Run Tests: ${params.RUN_TESTS}"
                echo "â•‘     â€¢ Build Number: ${env.BUILD_NUMBER}"
                echo "â•‘     â€¢ Git Commit: ${gitCommit}"
                echo "â•‘     â€¢ Build Time: ${currentBuild.durationString}"
                echo "â•‘     â€¢ Status: ${currentBuild.result ?: 'SUCCESS'}"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo ""
            }
        }
        
        success {
            echo ""
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘                    ğŸ‰ PARAMETERIZED DEPLOYMENT SUCCESS!                      â•‘"
            echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
            echo "â•‘  âœ… Deployment to ${params.ENVIRONMENT} completed successfully!"
            echo "â•‘  ğŸ›ï¸  Features: ${params.FEATURES} deployed"
            echo "â•‘  ğŸ“Š Version: ${params.VERSION} is now live"
            echo "â•‘  ğŸ”§ Monitoring: Active and configured"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo ""
        }
        
        failure {
            echo ""
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘                    âŒ PARAMETERIZED DEPLOYMENT FAILED!                       â•‘"
            echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
            echo "â•‘  ğŸš¨ Deployment to ${params.ENVIRONMENT} failed!"
            echo "â•‘  ğŸ”„ Rollback initiated automatically"
            echo "â•‘  ğŸ“ On-call engineer notified"
            echo "â•‘  ğŸ“Š Check logs for details"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo ""
        }
    }
}
