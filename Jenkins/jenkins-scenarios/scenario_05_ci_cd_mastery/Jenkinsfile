pipeline {
    agent any
    
    // Production-grade options - Jenkins best practices
    options {
        timeout(time: 5, unit: 'MINUTES')           // 5-minute challenge!
        timestamps()                                  // Every log line timestamped
        buildDiscarder(logRotator(numToKeepStr: '5')) // Keep only last 5 builds
        skipDefaultCheckout()                         // We'll checkout manually
    }
    
    // Environment variables for the challenge
    environment {
        CHALLENGE_NAME = 'CI/CD Mastery Challenge'
        BUILD_TIMESTAMP = "${new Date().format('yyyyMMdd-HHmmss')}"
        CHALLENGE_DURATION = '5 minutes'
        MAX_SCORE = 1000
    }
    
    // Challenge parameters - attendees can customize
    parameters {
        choice(
            name: 'SKILL_LEVEL',
            choices: ['Beginner', 'Intermediate', 'Advanced', 'Expert'],
            description: 'Select your CI/CD skill level'
        )
        choice(
            name: 'CHALLENGE_TYPE',
            choices: ['Speed Run', 'Quality Focus', 'Security First', 'Performance Optimized'],
            description: 'Choose your challenge approach'
        )
        booleanParam(
            name: 'ENABLE_NOTIFICATIONS',
            defaultValue: true,
            description: 'Enable real-time challenge notifications?'
        )
        booleanParam(
            name: 'SHOW_LEADERBOARD',
            defaultValue: true,
            description: 'Display live leaderboard?'
        )
    }
    
    stages {
        stage('ğŸš€ Challenge Setup') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ® JENKINS CI/CD MASTERY CHALLENGE                       â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Challenge: ${CHALLENGE_NAME}"
                    echo "â•‘  â±ï¸  Duration: ${CHALLENGE_DURATION}"
                    echo "â•‘  ğŸ† Max Score: ${MAX_SCORE} points"
                    echo "â•‘  ğŸ‘¤ Skill Level: ${SKILL_LEVEL}"
                    echo "â•‘  ğŸ² Challenge Type: ${CHALLENGE_TYPE}"
                    echo "â•‘"
                    echo "â•‘  ğŸ® Ready to become a CI/CD Master?"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ Learning Objectives:"
                    echo "â•‘     â€¢ Master Jenkins pipeline fundamentals"
                    echo "â•‘     â€¢ Implement production CI/CD patterns"
                    echo "â•‘     â€¢ Experience gamified learning"
                    echo "â•‘     â€¢ Compete for the highest score"
                    echo "â•‘     â€¢ Build real-world skills"
                    echo "â•‘"
                    echo "â•‘  ğŸš€ Let's begin your CI/CD mastery journey!"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    // Initialize challenge scoring
                    env.CHALLENGE_SCORE = 0
                    env.START_TIME = System.currentTimeMillis()
                    
                    // Show challenge parameters
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    âš™ï¸  CHALLENGE CONFIGURATION                              â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Skill Level: ${SKILL_LEVEL}"
                    echo "â•‘  ğŸ² Challenge Type: ${CHALLENGE_TYPE}"
                    echo "â•‘  ğŸ”” Notifications: ${ENABLE_NOTIFICATIONS ? 'Enabled' : 'Disabled'}"
                    echo "â•‘  ğŸ† Leaderboard: ${SHOW_LEADERBOARD ? 'Enabled' : 'Disabled'}"
                    echo "â•‘  â±ï¸  Time Limit: 5 minutes"
                    echo "â•‘  ğŸ® Mode: Interactive Gamified Learning"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
        
        stage('ğŸ“‹ Code Quality Gate') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ“‹ CHALLENGE 1: CODE QUALITY GATE                        â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Objective: Implement automated quality checks"
                    echo "â•‘  â±ï¸  Time Limit: 1 minute"
                    echo "â•‘  ğŸ† Max Points: ${SKILL_LEVEL == 'Expert' ? '200' : SKILL_LEVEL == 'Advanced' ? '150' : SKILL_LEVEL == 'Intermediate' ? '100' : '50'}"
                    echo "â•‘"
                    
                    // Checkout code
                    checkout scm
                    
                    // Simulate code quality checks
                    echo "â•‘  ğŸ” Running code quality analysis..."
                    echo "â•‘"
                    
                    // Simulate different quality checks based on skill level
                    def qualityChecks = [
                        'Beginner': [
                            ['Syntax Check', 'Validating code syntax', 25],
                            ['Basic Linting', 'Checking code style', 25]
                        ],
                        'Intermediate': [
                            ['Syntax Check', 'Validating code syntax', 30],
                            ['Linting', 'Checking code style and standards', 30],
                            ['Code Coverage', 'Analyzing test coverage', 40]
                        ],
                        'Advanced': [
                            ['Syntax Check', 'Validating code syntax', 40],
                            ['Linting', 'Checking code style and standards', 40],
                            ['Code Coverage', 'Analyzing test coverage', 40],
                            ['Security Scan', 'Detecting security vulnerabilities', 30]
                        ],
                        'Expert': [
                            ['Syntax Check', 'Validating code syntax', 40],
                            ['Linting', 'Checking code style and standards', 40],
                            ['Code Coverage', 'Analyzing test coverage', 40],
                            ['Security Scan', 'Detecting security vulnerabilities', 40],
                            ['Performance Analysis', 'Optimizing code performance', 40]
                        ]
                    ]
                    
                    def checks = qualityChecks[SKILL_LEVEL] ?: qualityChecks['Beginner']
                    def totalPoints = 0
                    
                    checks.each { check ->
                        def checkName = check[0]
                        def checkDesc = check[1]
                        def checkPoints = check[2]
                        
                        echo "â•‘  ğŸ” ${checkName}..."
                        echo "â•‘     ${checkDesc}"
                        
                        // Simulate processing with progress
                        for (int i = 1; i <= 3; i++) {
                            echo "â•‘     ${'â–ˆ' * i}${'â–‘' * (3 - i)} Processing... (${i * 33}%)"
                            sleep(0.5)
                        }
                        
                        echo "â•‘     âœ… ${checkName} - PASSED (+${checkPoints} points)"
                        totalPoints += checkPoints
                        echo "â•‘"
                    }
                    
                    env.CHALLENGE_SCORE = env.CHALLENGE_SCORE.toInteger() + totalPoints
                    
                    echo "â•‘  ğŸ† Quality Gate Complete!"
                    echo "â•‘     Points Earned: +${totalPoints}"
                    echo "â•‘     Total Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE}"
                    echo "â•‘     Progress: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ Next: Testing Strategy Challenge"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
        
        stage('ğŸ§ª Testing Strategy') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ§ª CHALLENGE 2: TESTING STRATEGY                         â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Objective: Implement comprehensive testing approach"
                    echo "â•‘  â±ï¸  Time Limit: 1 minute"
                    echo "â•‘  ğŸ² Strategy: ${CHALLENGE_TYPE}"
                    echo "â•‘  ğŸ† Max Points: ${CHALLENGE_TYPE == 'Quality Focus' ? '250' : CHALLENGE_TYPE == 'Security First' ? '200' : CHALLENGE_TYPE == 'Performance Optimized' ? '180' : '120'}"
                    echo "â•‘"
                    
                    // Simulate different testing strategies based on challenge type
                    def testStrategies = [
                        'Speed Run': [
                            ['Unit Tests', 'Fast, isolated component tests', 60],
                            ['Smoke Tests', 'Basic functionality verification', 60]
                        ],
                        'Quality Focus': [
                            ['Unit Tests', 'Fast, isolated component tests', 80],
                            ['Integration Tests', 'Component interaction testing', 80],
                            ['E2E Tests', 'End-to-end user journey testing', 90]
                        ],
                        'Security First': [
                            ['Unit Tests', 'Fast, isolated component tests', 70],
                            ['Security Tests', 'Authentication and authorization', 70],
                            ['Vulnerability Scans', 'Dependency and code security', 60]
                        ],
                        'Performance Optimized': [
                            ['Unit Tests', 'Fast, isolated component tests', 60],
                            ['Load Tests', 'High-traffic performance testing', 70],
                            ['Performance Tests', 'Response time and resource usage', 50]
                        ]
                    ]
                    
                    def tests = testStrategies[CHALLENGE_TYPE] ?: testStrategies['Speed Run']
                    def totalPoints = 0
                    
                    echo "â•‘  ğŸ§ª Executing ${CHALLENGE_TYPE} testing strategy..."
                    echo "â•‘"
                    
                    tests.each { test ->
                        def testName = test[0]
                        def testDesc = test[1]
                        def testPoints = test[2]
                        
                        echo "â•‘  ğŸ§ª Running ${testName}..."
                        echo "â•‘     ${testDesc}"
                        
                        // Simulate test execution with progress
                        for (int i = 1; i <= 4; i++) {
                            echo "â•‘     ${'â–ˆ' * i}${'â–‘' * (4 - i)} Executing... (${i * 25}%)"
                            sleep(0.4)
                        }
                        
                        echo "â•‘     âœ… ${testName} - PASSED (+${testPoints} points)"
                        totalPoints += testPoints
                        echo "â•‘"
                    }
                    
                    env.CHALLENGE_SCORE = env.CHALLENGE_SCORE.toInteger() + totalPoints
                    
                    echo "â•‘  ğŸ† Testing Strategy Complete!"
                    echo "â•‘     Points Earned: +${totalPoints}"
                    echo "â•‘     Total Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE}"
                    echo "â•‘     Progress: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ Next: Containerization Challenge"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
        
        stage('ğŸ³ Containerization') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ³ CHALLENGE 3: CONTAINERIZATION                          â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Objective: Containerize application with Docker best practices"
                    echo "â•‘  â±ï¸  Time Limit: 1 minute"
                    echo "â•‘  ğŸ† Max Points: 150"
                    echo "â•‘"
                    
                    // Create a simple Dockerfile dynamically
                    writeFile file: 'Dockerfile', text: '''FROM python:3.11-slim
WORKDIR /app
COPY . .
RUN pip install --no-cache-dir -r requirements.txt
EXPOSE 8080
CMD ["python", "app.py"]'''
                    
                    // Create a simple requirements.txt
                    writeFile file: 'requirements.txt', text: 'flask==2.3.3\nrequests==2.31.0'
                    
                    // Create a simple app.py
                    writeFile file: 'app.py', text: '''from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello():
    return "ğŸš€ CI/CD Mastery Challenge - Containerized!"

@app.route('/health')
def health():
    return "âœ… Healthy", 200

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)'''
                    
                    echo "â•‘  ğŸ“¦ Building Docker image..."
                    echo "â•‘"
                    
                    // Simulate Docker build with detailed steps
                    def buildSteps = [
                        ['Analyzing Dockerfile', 'Validating Docker configuration', 30],
                        ['Downloading base image', 'Pulling python:3.11-slim', 30],
                        ['Installing dependencies', 'Running pip install', 30],
                        ['Copying application code', 'Adding source files to container', 30],
                        ['Setting up container', 'Configuring runtime environment', 30]
                    ]
                    
                    def totalPoints = 0
                    buildSteps.each { step ->
                        def stepName = step[0]
                        def stepDesc = step[1]
                        def stepPoints = step[2]
                        
                        echo "â•‘  ğŸ”¨ ${stepName}..."
                        echo "â•‘     ${stepDesc}"
                        
                        // Simulate build progress
                        for (int i = 1; i <= 3; i++) {
                            echo "â•‘     ${'â–ˆ' * i}${'â–‘' * (3 - i)} Building... (${i * 33}%)"
                            sleep(0.5)
                        }
                        
                        echo "â•‘     âœ… ${stepName} - COMPLETE (+${stepPoints} points)"
                        totalPoints += stepPoints
                        echo "â•‘"
                    }
                    
                    echo "â•‘  ğŸ³ Docker image built successfully!"
                    echo "â•‘     Image: ci-cd-challenge:latest"
                    echo "â•‘     Size: ~150MB (optimized)"
                    echo "â•‘     Layers: 5 (efficient)"
                    echo "â•‘"
                    
                    env.CHALLENGE_SCORE = env.CHALLENGE_SCORE.toInteger() + totalPoints
                    
                    echo "â•‘  ğŸ† Containerization Complete!"
                    echo "â•‘     Points Earned: +${totalPoints}"
                    echo "â•‘     Total Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE}"
                    echo "â•‘     Progress: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ Next: Deployment Strategy Challenge"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
        
        stage('ğŸš€ Deployment Strategy') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸš€ CHALLENGE 4: DEPLOYMENT STRATEGY                       â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Objective: Deploy application with production strategy"
                    echo "â•‘  â±ï¸  Time Limit: 1 minute"
                    echo "â•‘  ğŸ² Strategy: ${CHALLENGE_TYPE}"
                    echo "â•‘"
                    
                    // Simulate different deployment strategies
                    def deploymentStrategies = [
                        'Speed Run': ['Direct Deployment', 'Fast, simple deployment', 100],
                        'Quality Focus': ['Blue-Green Deployment', 'Zero-downtime with instant rollback', 200],
                        'Security First': ['Canary Deployment', 'Gradual rollout with monitoring', 180],
                        'Performance Optimized': ['Rolling Update', 'Smooth updates with load balancing', 160]
                    ]
                    
                    def strategy = deploymentStrategies[CHALLENGE_TYPE] ?: deploymentStrategies['Speed Run']
                    def strategyName = strategy[0]
                    def strategyDesc = strategy[1]
                    def strategyPoints = strategy[2]
                    
                    echo "â•‘  ğŸ¯ Selected Strategy: ${strategyName}"
                    echo "â•‘     ${strategyDesc}"
                    echo "â•‘  ğŸ† Max Points: ${strategyPoints}"
                    echo "â•‘"
                    
                    // Simulate deployment steps
                    def deploySteps = [
                        ['Pre-deployment validation', 'Checking environment readiness', 40],
                        ['Environment preparation', 'Setting up deployment infrastructure', 40],
                        ['Application deployment', 'Deploying new version', 40],
                        ['Health checks', 'Verifying application health', 40],
                        ['Traffic routing', 'Switching traffic to new version', 40]
                    ]
                    
                    def totalPoints = 0
                    deploySteps.each { step ->
                        def stepName = step[0]
                        def stepDesc = step[1]
                        def stepPoints = step[2]
                        
                        echo "â•‘  ğŸš€ ${stepName}..."
                        echo "â•‘     ${stepDesc}"
                        
                        // Simulate deployment progress
                        for (int i = 1; i <= 4; i++) {
                            echo "â•‘     ${'â–ˆ' * i}${'â–‘' * (4 - i)} Deploying... (${i * 25}%)"
                            sleep(0.4)
                        }
                        
                        echo "â•‘     âœ… ${stepName} - COMPLETE (+${stepPoints} points)"
                        totalPoints += stepPoints
                        echo "â•‘"
                    }
                    
                    echo "â•‘  ğŸš€ Deployment completed successfully!"
                    echo "â•‘     Strategy: ${strategyName}"
                    echo "â•‘     Status: âœ… Healthy"
                    echo "â•‘     Uptime: 99.9%"
                    echo "â•‘     Response Time: <100ms"
                    echo "â•‘"
                    
                    env.CHALLENGE_SCORE = env.CHALLENGE_SCORE.toInteger() + totalPoints
                    
                    echo "â•‘  ğŸ† Deployment Strategy Complete!"
                    echo "â•‘     Points Earned: +${totalPoints}"
                    echo "â•‘     Total Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE}"
                    echo "â•‘     Progress: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ Next: Monitoring & Observability Challenge"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
        
        stage('ğŸ“Š Monitoring & Observability') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ“Š CHALLENGE 5: MONITORING & OBSERVABILITY                â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  ğŸ¯ Objective: Set up comprehensive monitoring and observability"
                    echo "â•‘  â±ï¸  Time Limit: 1 minute"
                    echo "â•‘  ğŸ† Max Points: 100"
                    echo "â•‘"
                    
                    // Simulate monitoring setup
                    def monitoringChecks = [
                        ['Application Health Monitoring', 'Setting up health check endpoints', 20],
                        ['Performance Metrics Collection', 'Configuring metrics gathering', 20],
                        ['Log Aggregation Setup', 'Centralizing log collection', 20],
                        ['Alert Configuration', 'Setting up proactive alerts', 20],
                        ['Dashboard Creation', 'Building monitoring dashboards', 20]
                    ]
                    
                    def totalPoints = 0
                    monitoringChecks.each { check ->
                        def checkName = check[0]
                        def checkDesc = check[1]
                        def checkPoints = check[2]
                        
                        echo "â•‘  ğŸ“Š Setting up ${checkName}..."
                        echo "â•‘     ${checkDesc}"
                        
                        // Simulate setup progress
                        for (int i = 1; i <= 3; i++) {
                            echo "â•‘     ${'â–ˆ' * i}${'â–‘' * (3 - i)} Configuring... (${i * 33}%)"
                            sleep(0.4)
                        }
                        
                        echo "â•‘     âœ… ${checkName} - ACTIVE (+${checkPoints} points)"
                        totalPoints += checkPoints
                        echo "â•‘"
                    }
                    
                    // Simulate real-time metrics
                    echo "â•‘  ğŸ“ˆ Live Metrics Dashboard:"
                    echo "â•‘     â€¢ CPU Usage: 45% (Normal)"
                    echo "â•‘     â€¢ Memory Usage: 67% (Normal)"
                    echo "â•‘     â€¢ Response Time: 120ms (Excellent)"
                    echo "â•‘     â€¢ Error Rate: 0.1% (Very Low)"
                    echo "â•‘     â€¢ Uptime: 99.9% (Excellent)"
                    echo "â•‘     â€¢ Active Connections: 1,247"
                    echo "â•‘     â€¢ Requests/min: 2,340"
                    echo "â•‘"
                    
                    echo "â•‘  ğŸš¨ Alert Status:"
                    echo "â•‘     â€¢ Critical: 0"
                    echo "â•‘     â€¢ Warning: 0"
                    echo "â•‘     â€¢ Info: 3"
                    echo "â•‘     â€¢ All systems operational âœ…"
                    echo "â•‘"
                    
                    env.CHALLENGE_SCORE = env.CHALLENGE_SCORE.toInteger() + totalPoints
                    
                    echo "â•‘  ğŸ† Monitoring & Observability Complete!"
                    echo "â•‘     Points Earned: +${totalPoints}"
                    echo "â•‘     Total Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE}"
                    echo "â•‘     Progress: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ All Challenges Complete! ğŸ‰"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
    }
    
    post {
        success {
            script {
                def endTime = System.currentTimeMillis()
                def duration = (endTime - env.START_TIME.toLong()) / 1000
                
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                    ğŸ‰ CHALLENGE COMPLETED! ğŸ‰                                â•‘"
                echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                echo "â•‘  ğŸ† Final Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE} points"
                echo "â•‘  â±ï¸  Completion Time: ${duration} seconds"
                echo "â•‘  ğŸ¯ Skill Level: ${SKILL_LEVEL}"
                echo "â•‘  ğŸ² Challenge Type: ${CHALLENGE_TYPE}"
                echo "â•‘  ğŸ“Š Completion Rate: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                echo "â•‘"
                
                // Calculate performance rating
                def performanceRating = "ğŸ¥‰ Bronze"
                def ratingDescription = "Good effort! Keep practicing to improve."
                if (env.CHALLENGE_SCORE.toInteger() >= 900) {
                    performanceRating = "ğŸ† Legendary"
                    ratingDescription = "Outstanding! You're a CI/CD master!"
                } else if (env.CHALLENGE_SCORE.toInteger() >= 800) {
                    performanceRating = "ğŸ¥‡ Gold"
                    ratingDescription = "Excellent! You've mastered CI/CD!"
                } else if (env.CHALLENGE_SCORE.toInteger() >= 600) {
                    performanceRating = "ğŸ¥ˆ Silver"
                    ratingDescription = "Great job! You're well on your way!"
                }
                
                echo "â•‘  ğŸ… Performance Rating: ${performanceRating}"
                echo "â•‘  ğŸ’¬ ${ratingDescription}"
                echo "â•‘"
                
                // Show achievements
                echo "â•‘  ğŸ–ï¸  Achievements Unlocked:"
                if (env.CHALLENGE_SCORE.toInteger() >= 100) {
                    echo "â•‘     âœ… First Steps - Completed your first challenge"
                }
                if (env.CHALLENGE_SCORE.toInteger() >= 300) {
                    echo "â•‘     âœ… Quality Guardian - Mastered code quality"
                }
                if (env.CHALLENGE_SCORE.toInteger() >= 500) {
                    echo "â•‘     âœ… Test Master - Conquered testing strategies"
                }
                if (env.CHALLENGE_SCORE.toInteger() >= 700) {
                    echo "â•‘     âœ… Container Expert - Mastered containerization"
                }
                if (env.CHALLENGE_SCORE.toInteger() >= 800) {
                    echo "â•‘     âœ… Deployment Pro - Conquered deployment strategies"
                }
                if (env.CHALLENGE_SCORE.toInteger() >= 900) {
                    echo "â•‘     âœ… Monitoring Master - Achieved full observability"
                }
                echo "â•‘"
                
                echo "â•‘  ğŸ® You've mastered Jenkins CI/CD!"
                echo "â•‘  ğŸš€ Ready for production deployments!"
                echo "â•‘  ğŸ’¡ Continue learning with advanced Jenkins features!"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                
                // Show leaderboard if enabled
                if (params.SHOW_LEADERBOARD) {
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    ğŸ† LIVE LEADERBOARD                                       â•‘"
                    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                    echo "â•‘  #1 ğŸ¥‡ Alex Chen     - 950 points (Expert, Performance Optimized)"
                    echo "â•‘  #2 ğŸ¥ˆ Sarah Kim     - 875 points (Advanced, Quality Focus)"
                    echo "â•‘  #3 ğŸ¥‰ Mike Johnson  - 820 points (Intermediate, Security First)"
                    echo "â•‘  #4    You           - ${env.CHALLENGE_SCORE} points (${SKILL_LEVEL}, ${CHALLENGE_TYPE})"
                    echo "â•‘  #5    Emma Wilson   - 750 points (Beginner, Speed Run)"
                    echo "â•‘"
                    echo "â•‘  ğŸ¯ Challenge Statistics:"
                    echo "â•‘     â€¢ Total Participants: 1,247"
                    echo "â•‘     â€¢ Average Score: 720 points"
                    echo "â•‘     â€¢ Your Rank: Top ${env.CHALLENGE_SCORE.toInteger() >= 800 ? '10%' : env.CHALLENGE_SCORE.toInteger() >= 600 ? '25%' : '50%'}"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
                
                // Show next steps
                echo ""
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                    ğŸš€ NEXT STEPS & LEARNING PATH                              â•‘"
                echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                echo "â•‘  ğŸ“š Continue Your CI/CD Journey:"
                echo "â•‘     â€¢ Explore Jenkins plugins and integrations"
                echo "â•‘     â€¢ Learn advanced pipeline patterns"
                echo "â•‘     â€¢ Implement real-world CI/CD pipelines"
                echo "â•‘     â€¢ Join the Jenkins community"
                echo "â•‘     â€¢ Contribute to open source projects"
                echo "â•‘"
                echo "â•‘  ğŸ¯ Recommended Next Scenarios:"
                echo "â•‘     â€¢ Kubernetes Deployment Scenarios"
                echo "â•‘     â€¢ Advanced Jenkins Patterns"
                echo "â•‘     â€¢ Production CI/CD Strategies"
                echo "â•‘     â€¢ Security and Compliance"
                echo "â•‘"
                echo "â•‘  ğŸ’¡ Pro Tip: Practice makes perfect! Try different skill levels"
                echo "â•‘     and challenge types to master all aspects of CI/CD."
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
        }
        
        failure {
            script {
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                    ğŸ’ª CHALLENGE FAILED - BUT DON'T GIVE UP!                  â•‘"
                echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
                echo "â•‘  ğŸ¯ Current Score: ${env.CHALLENGE_SCORE}/${MAX_SCORE} points"
                echo "â•‘  ğŸ“Š Progress: ${(env.CHALLENGE_SCORE.toInteger() / MAX_SCORE.toInteger() * 100).intValue()}%"
                echo "â•‘  ğŸ² Challenge Type: ${CHALLENGE_TYPE}"
                echo "â•‘  ğŸ‘¤ Skill Level: ${SKILL_LEVEL}"
                echo "â•‘"
                echo "â•‘  ğŸ’¡ Learning Opportunities:"
                echo "â•‘     â€¢ Review the failed stage carefully"
                echo "â•‘     â€¢ Try a different skill level or challenge type"
                echo "â•‘     â€¢ Practice the fundamentals first"
                echo "â•‘     â€¢ Ask for help from the community"
                echo "â•‘"
                echo "â•‘  ğŸ”„ Retry the challenge to improve your score!"
                echo "â•‘  ğŸ“š Learn from the failure and come back stronger!"
                echo "â•‘  ğŸš€ Every master was once a beginner!"
                echo "â•‘"
                echo "â•‘  ğŸ–ï¸  Remember: Failure is just feedback!"
                echo "â•‘  ğŸ’ª You've got this! Try again! ğŸ’ª"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
        }
        
        always {
            script {
                // Cleanup
                echo "ğŸ§¹ Cleaning up challenge artifacts..."
                sh 'rm -f Dockerfile requirements.txt app.py 2>/dev/null || true'
            }
        }
    }
}
